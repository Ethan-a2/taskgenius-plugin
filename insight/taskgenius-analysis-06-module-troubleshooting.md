# Task Genius 模块问题排查

日期：2026-01-22

## 模块出现问题的可能原因

1. 索引器/仓库
   - 文件变更未被捕获（监听器失效或路径过滤不当）
   - 解析失败（语法边界、特殊字符、国际化文本）
   - 缓存不一致（localforage 数据过期或冲突）

2. 视图/渲染器
   - 渲染异常（空数据、未处理的边界条件）
   - 状态管理错误（useWidgetState 未正确更新）
   - 代码块参数解析错误导致 Widget 初始化失败

3. 编辑器扩展
   - CodeMirror 扩展注册顺序问题
   - 快捷键冲突或事件处理未清理
   - 大文档上性能退化导致交互迟滞

4. 国际化与脚本
   - 翻译 key 缺失或类型不匹配
   - 提取/生成脚本失败（路径变更、权限问题）

5. 设置与迁移
   - 旧版配置未迁移或迁移脚本异常
   - 兼容性层未覆盖新特性导致配置失效

## 模块排查步骤

1. 快速定位
   - 查看开发者控制台错误日志（Obsidian）
   - 开启调试开关（开发模式下增加 verbose 日志）
   - 根据报错堆栈定位到具体模块文件

2. 索引与解析
   - 手动触发重索引并观察耗时与异常
   - 对失败文件输出最小复现片段，编写单测覆盖
   - 检查文件监听与路径过滤规则

3. 视图与渲染
   - 使用 mock 数据隔离渲染器，验证空/异常输入处理
   - 对视图更新流程添加时序日志，确认数据到 UI 的链路
   - 检查代码块参数解析器的健壮性（默认值、错误提示）

4. 编辑器扩展
   - 临时禁用部分扩展以二分定位问题
   - 检查注册/销毁钩子是否成对出现
   - 对性能关键路径做节流与窗口化处理

5. 国际化与脚本
   - 运行提取与生成脚本，检查缺失键与类型差异
   - 对新增文案进行回归测试与手动检视

6. 设置与迁移
   - 打印当前配置与版本，确认迁移是否执行
   - 编写迁移单测覆盖典型旧版配置
   - 在 UI 中提示用户手动检查重要配置项

7. 回归与发布
   - 在 Jest 中增加模块级回归测试
   - 更新 CHANGELOG 并记录排查与修复要点
   - 在 beta 渠道先发布验证，再合入稳定版
